{% comment %}
Fabric Enquiry Gallery (Section)
- Add a "Fabric Category" block
- Then add one or more "Variant Image" blocks directly after it
- Repeat for additional categories
{% endcomment %}

<section id="fabric-enquiry-gallery" class="fabric-enquiry-section">
  <style>
    :root { --modal-bg: rgba(0,0,0,.55); --card-border:#e6e6e6; }
    .zc-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px;max-width:1100px;margin:24px auto;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    .zc-card{border:1px solid var(--card-border);border-radius:12px;overflow:hidden;background:#fff;  transition: transform 0.3s ease;
}
  .zc-card:hover {
  transform: scale(1.02);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
}
    .zc-card__trigger{display:block;cursor:pointer;text-decoration:none;color:inherit}
    .zc-card__frame{width:100%;aspect-ratio:4/3;display:grid;place-items:center;background:#f7f7f7}
    .zc-card__frame img{width:100%;height:300px;object-fit:cover;display:block}
    .zc-card__body{padding:10px 12px;display:flex;align-items:center;justify-content:space-between;gap:8px}
    .zc-card__title{font-size:14px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .zc-card__open{appearance:none;border:none;background:#111;color:#fff;font-weight:600;border-radius:8px;padding:8px 10px;cursor:pointer;font-size:12px}

    .zc-modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:var(--modal-bg);z-index:999999;padding:24px}
    .zc-modal.is-open{display:flex}
    .zc-modal__card{background:#fff;width:100%;max-width:980px;border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.15);overflow:hidden}
    .zc-modal__head{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid var(--card-border)}
    .zc-modal__title{font-weight:700;font-size:15px}
    .zc-modal__close{appearance:none;border:none;background:transparent;font-size:22px;line-height:1;cursor:pointer}

    .picker{display:grid;grid-template-columns:2fr 1fr;gap:16px;padding:16px;max-height:min(80vh,760px);overflow:auto}
    .primary{position:relative;border:1px solid var(--card-border);border-radius:12px;padding:12px;background:#fff}
    .primary .stage{width:100%;aspect-ratio:4/3;display:grid;place-items:center;background:#fafafa;border-radius:8px}
    .primary img{width:100%;height:500px;object-fit:cover;border-radius:8px}
   @media (max-width:500px){
    .primary img{
        height:250px;
    }
    .zc-grid {
    grid-template-columns: repeat(auto-fill, minmax(150px, 2fr));
    }
    .zc-card__frame img{
    height:200px;
    }
}
    .side{display:grid;gap:16px}
    .card{border:1px solid var(--card-border);border-radius:12px;background:#fff;padding:12px}
    .card h4{margin:0 0 10px;font-size:14px;font-weight:600}
    .secondary{display:grid;gap:10px;grid-template-columns:repeat(2,1fr)}
    .thumb{position:relative;border:1px solid var(--card-border);border-radius:10px;overflow:hidden;background:#fff;cursor:pointer}
    .thumb .thumb-frame{width:100%;height:100%;aspect-ratio:4/3;display:grid;place-items:center;background:#f7f7f7}
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}
    .thumb.selected{outline:2px solid #111}
    .thumb .check{position:absolute;top:6px;right:6px;background:#111;color:#fff;border-radius:999px;font-size:11px;padding:2px 6px;display:none}
    .thumb.selected .check{display:inline-block}
    @media (max-width:900px){.picker{grid-template-columns:1fr}.secondary{grid-template-columns:repeat(3,1fr)}}
    .secondary-data{display:none}

    #imgForm{display:flex;flex-direction:column;gap:16px;padding:20px;border-radius:12px;background:#fff;border:1px solid #e5e5e5;box-shadow:0 2px 8px rgba(0,0,0,0.05)}
    #imgForm label{font-size:13px;color:#555;display:block;margin-bottom:6px;font-weight:600}
    #imgForm input[type="text"],#imgForm input[type="email"]{width:100%;padding:10px 5px;border:1px solid #ccc;border-radius:8px;font-size:14px;color:#222;background:#fafafa;transition:border .2s,box-shadow .2s}
    #imgForm input[type="text"]:focus,#imgForm input[type="email"]:focus{outline:none;border-color:#111;box-shadow:0 0 0 2px rgba(0,0,0,0.08);background:#fff}
    #imgForm .actions{display:flex;gap:10px;margin-top:8px}
    #imgForm .btn{appearance:none;border:none;border-radius:8px;padding:10px 18px;font-weight:600;font-size:14px;cursor:pointer;transition:background .2s,transform .15s}
    #imgForm .btn.primary{background:#111;color:#fff}
    #imgForm .btn.primary:hover{background:#222;transform:translateY(-1px)}
    #imgForm .btn.ghost{background:#f1f1f1;color:#111}
    #imgForm .btn.ghost:hover{background:#e3e3e3}

    /* Size input with inline unit */
#imgForm .with-unit { position: relative; }
#imgForm .with-unit input { padding-right: 44px; }
#imgForm .with-unit::after {
  content: "Yard";
  position: absolute;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);
  background: #000;
  color: #fff;
  border-radius: 6px;
  padding: 2px 6px;
  font-size: 12px;
  pointer-events: none;
}
#imgForm .with-unit label small { font-weight: 600; color: #777; }
  {% comment %} .zc-card__desc{
    font-size:12px;color:#666;line-height:1.45;
    display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden
  } {% endcomment %}
  #modalDesc{
    font-size:small;
    color:#000;
    line-height:1.55;
    padding: 10px 5px;
  }
  </style>

  <div class="zc-grid" id="zcGrid">
    {%- for block in section.blocks -%}
      {%- if block.type == 'fabric' -%}
        <div class="zc-card"
             data-title="{{ block.settings.title | escape }}"
             data-primary="{{ block.settings.primary_image | image_url: width: 800 }}"
            data-desc="{{ block.settings.description | escape }}">
          <a class="zc-card__trigger" href="javascript:void(0)">
            <div class="zc-card__frame">
              <img src="{{ block.settings.primary_image | image_url: width: 800 }}"
                   alt="{{ block.settings.primary_alt | escape }}">
            </div>
          </a>
          <div class="zc-card__body">
            <div class="zc-card__title">{{ block.settings.title }}</div>
            <button class="zc-card__open" type="button">Choose</button>
          </div>
          <div class="secondary-data">
            {%- assign start_index = forloop.index -%}
            {%- for b in section.blocks -%}
              {%- if forloop.index > start_index -%}
                {%- if b.type == 'fabric' -%}{% break %}{%- endif -%}
                {%- if b.type == 'variant' -%}
                  <div class="thumb" data-title="{{ b.settings.title | escape }}">
                    <div class="thumb-frame">
                      <img src="{{ b.settings.image | image_url: width: 600 }}"
                           alt="{{ b.settings.alt | escape }}">
                    </div>
                  </div>
                {%- endif -%}
              {%- endif -%}
            {%- endfor -%}
          </div>
        </div>
      {%- endif -%}
    {%- endfor -%}
  </div>

  <!-- Shared Modal -->
  <div class="zc-modal" id="zcModal" role="dialog" aria-modal="true" aria-labelledby="zcModalTitle">
    <div class="zc-modal__card">
      <div class="zc-modal__head">
        <div class="zc-modal__title" id="zcModalTitle">Select Image</div>
        <button class="zc-modal__close" id="closeModal" aria-label="Close">×</button>
      </div>

      <div class="picker">
        <div class="primary">
          <div class="stage"><img id="modalPrimaryImg" src="" alt=""></div>
                <p id="modalDesc" class="desc"></p>

        </div>

        <div class="side">
          <div class="card">
            <h4>Images</h4>
            <div class="secondary" id="modalSecondary"></div>

          </div>

          {% form 'contact', id: 'imgForm', class: 'card form' %}
            <h4>Submit Fabric Enquiry</h4>
           {% if form.posted_successfully? %}
             <script>
             window.localStorage.setItem('fabricFormSuccess', 'true');
             </script>
             {% endif %}

            {{ form.errors | default_errors }}

            <div>
              <label for="fabricName">Fabric Name</label>
              <input id="fabricName" name="contact[Fabric Name]" type="text" placeholder="Enter fabric name" required>
            </div>
            <div class="with-unit">
  <label for="sizeInput">Dimensions <small>(Yard)</small></label>
  <input
    id="sizeInput"
    name="contact[Dimensions (Yard)]"
    type="text"
    placeholder="e.g., Width × Height: 24 x 18"
    {% comment %} inputmode="decimal"
    pattern="^\s*\d+(?:\.\d+)?\s*[x×]\s*\d+(?:\.\d+)?\s*$"
    title="Use width × height (inches), e.g., 24 x 18" {% endcomment %}
    required>
</div>

            <div>
              <label for="emailInput">Email</label>
              <input id="emailInput" name="contact[email]" type="email" placeholder="Your Email" required>
            </div>
            <input type="hidden" id="selectedImageUrl" name="contact[Selected Image URL]" value="">
            <div class="actions">
              <button class="btn primary" type="submit">Send</button>
              <button class="btn ghost" type="button" id="resetSel">Reset</button>
            </div>
          {% endform %}
        </div>
      </div>
    </div>
  </div>

  <script>
(() => {
  const grid = document.getElementById('zcGrid');
  const modal = document.getElementById('zcModal');
  const closeModal = document.getElementById('closeModal');
  const modalTitle = document.getElementById('zcModalTitle');
  const modalPrimaryImg = document.getElementById('modalPrimaryImg');
  const modalSecondary = document.getElementById('modalSecondary');
  const form = document.getElementById('imgForm');
  const resetBtn = document.getElementById('resetSel');
  const fabricNameInput = document.getElementById('fabricName');
  const emailInput = document.getElementById('emailInput');
  const selectedImageUrlInput = document.getElementById('selectedImageUrl');
  let currentCard = null;
  const modalDesc = document.getElementById('modalDesc');


  /* ===== Toast Popup ===== */
  function showToast(message) {
    let toast = document.createElement("div");
    toast.textContent = message;
    Object.assign(toast.style, {
      position: "fixed",
      bottom: "40px",
      right: "40px",
      background: "#0a8a0a",
      color: "#fff",
      padding: "14px 22px",
      borderRadius: "8px",
      boxShadow: "0 4px 10px rgba(0,0,0,0.2)",
      zIndex: "999999",
      fontWeight: "600",
      fontSize: "14px",
      opacity: "0",
      transition: "opacity 0.3s ease"
    });
    document.body.appendChild(toast);
    requestAnimationFrame(() => toast.style.opacity = "1");
    setTimeout(() => {
      toast.style.opacity = "0";
      setTimeout(() => toast.remove(), 500);
    }, 3500);
  }

  /* ===== Image Handling ===== */
  function cloneThumb(node){
    const wrap = node.cloneNode(true);
    const check = document.createElement('span');
    check.className = 'check';
    check.textContent = '✓ Selected';
    wrap.appendChild(check);
    return wrap;
  }

  function selectThumb(thumb){
    modalSecondary.querySelectorAll('.thumb').forEach(t => t.classList.remove('selected'));
    thumb.classList.add('selected');
    const img = thumb.querySelector('img');
    const title = (thumb.dataset.title || img.alt || '').trim();
    modalPrimaryImg.src = img.src;
    modalPrimaryImg.alt = title || (currentCard?.dataset?.title || 'Selected image');
    if (fabricNameInput) fabricNameInput.value = title || currentCard?.dataset?.title || '';
    if (selectedImageUrlInput) selectedImageUrlInput.value = img.src;
  }

  function openForCard(cardEl){
    currentCard = cardEl;
    modalTitle.textContent = cardEl.dataset.title || 'Select Image';
    modalSecondary.innerHTML = '';
      if (modalDesc) modalDesc.textContent = (cardEl.dataset.desc || '').trim();

    const thumbs = Array.from(cardEl.querySelectorAll('.secondary-data .thumb')).map(cloneThumb);
    thumbs.forEach(t => modalSecondary.appendChild(t));
    if (thumbs.length){ selectThumb(thumbs[0]); }
    else {
      const fallbackSrc = cardEl.dataset.primary || '';
      modalPrimaryImg.src = fallbackSrc;
      modalPrimaryImg.alt = cardEl.dataset.title || 'Primary image';
      if (fabricNameInput) fabricNameInput.value = cardEl.dataset.title || '';
      if (selectedImageUrlInput) selectedImageUrlInput.value = fallbackSrc;
    }
    modal.classList.add('is-open');
    closeModal.focus({ preventScroll: true });
  }

  grid.addEventListener('click', (e) => {
    const trigger = e.target.closest('.zc-card__trigger, .zc-card__open');
    if (!trigger) return;
    const card = trigger.closest('.zc-card');
    if (card) openForCard(card);
  });

  const close = () => modal.classList.remove('is-open');
  closeModal.addEventListener('click', close);
  modal.addEventListener('click', (e)=>{ if(e.target===modal) close(); });
  document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') close(); });

  modalSecondary.addEventListener('click', (e) => {
    const thumb = e.target.closest('.thumb');
    if (!thumb) return;
    selectThumb(thumb);
  });

resetBtn.addEventListener('click', () => {
  const first = modalSecondary.querySelector('.thumb');
  if (first) selectThumb(first);
  if (fabricNameInput) fabricNameInput.value = '';
  if (emailInput) emailInput.value = '';
  const sizeEl = document.getElementById('sizeInput');   // ← add
  if (sizeEl) sizeEl.value = '';                         // ← add
});


  /* ===== Show toast once and clean URL ===== */
  document.addEventListener("DOMContentLoaded", () => {
    if (window.localStorage.getItem('fabricFormSuccess') === 'true') {
      window.localStorage.removeItem('fabricFormSuccess');
      showToast("✅ Thank you! We’ve received your request.");
      // optional: close modal
      setTimeout(() => modal.classList.remove('is-open'), 1200);
      // clean URL (remove ?form_type=contact&success=1)
      if (window.history.replaceState) {
        const cleanURL = window.location.origin + window.location.pathname;
        window.history.replaceState({}, document.title, cleanURL);
      }
    }
  });
})();
</script>



  {% schema %}
  {
    "name": "Fabric Enquiry Gallery",
    "settings": [],
    "blocks": [
      {
        "type": "fabric",
        "name": "Fabric Category",
        "settings": [
          { "type": "text", "id": "title", "label": "Fabric Category Title" },
          { "type": "image_picker", "id": "primary_image", "label": "Primary Image" },
          { "type": "text", "id": "primary_alt", "label": "Primary Alt Text", "default": "Image Alt" },
          { "type": "textarea", "id": "description", "label": "Catalog Description", "info": "Short blurb shown on card and full text in modal." }
        ]
      },
      {
        "type": "variant",
        "name": "Variant Image",
        "settings": [
          { "type": "text", "id": "title", "label": "Image Title" },
          { "type": "text", "id": "alt", "label": "Alt Text", "default": "Image Alt" },
          { "type": "image_picker", "id": "image", "label": "Image" }
        ]
      }
    ],
    "presets": [
      { "name": "Fabric Enquiry Gallery" }
    ]
  }
  {% endschema %}
</section>
